<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <UsingTask AssemblyFile="tools\Partcover.MSBuild.dll" TaskName="PartCover.MSBuild.PartCover" />

  <Target Name="Coverage">
    <MakeDir Directories="Output"/>
    <ItemGroup>
      <TestAssemblies Include="test\**\bin\$(Configuration)\*Core.Tests.dll"
					  Exclude="test\**\*.Acceptance.Tests.dll;test\**\*.Integration.Tests.dll"/>
    </ItemGroup>
    <PropertyGroup>
      <ReportByAssembly>"tools\PartCover2\xslt\Report By Assembly.xslt"</ReportByAssembly>
      <ReportByClass>"tools\PartCover2\xslt\Report By Class.xslt"</ReportByClass>
    </PropertyGroup>
    <PartCover ToolPath="tools\Partcover2"
               Target=".\tools\Gallio\bin\Gallio.Echo.exe"
               TargetArgs="/r:Local @(TestAssemblies)"
               Output="Output\coverage.xml"
               Include="[Price*]*"
               Exclude="[Price*Tests*]*"
               />
    <Exec Command="$(Xslt) Output\coverage.xml $(ReportByAssembly) -o Output\coverage.html"/>
    <Exec Command="$(Xslt) Output\coverage.xml $(ReportByClass) -o Output\coverage2.html"/>
  </Target>
</Project>