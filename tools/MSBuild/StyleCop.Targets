<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

	<Target Name="StyleCop">
		<MakeDir Directories="Output"/>
    
		<!-- Run the StyleCopCmd from tools -->
		<Exec Command="tools\stylecopcmd\StyleCopCmd -sf Price.Displacement.Desktop.sln -ifp AssemblyInfo.cs -of output\stylecop.xml -sc Settings.StyleCop -tf tools\StyleCopCmd\StyleCopReport.xsl"  />
		<Exec Command="$(Xslt) Output\stylecop.violations.xml tools\stylecopcmd\ViolationsReport.xsl -o Output\StyleCop.Violations.html"/>

		<XmlQuery XmlFileName="Output\stylecop.violations.xml"
				  XPath = "count(/StyleCopViolations/Violation[@RuleId != 'SA0102'])">
			<Output TaskParameter="Values" PropertyName="OtherViolations" />
		</XmlQuery>
		<Message Text="Testing $(OtherViolations)"/>
		<Error Text="Stylecop Failed! Please check output\stylecop.violations.html!" Condition="$(OtherViolations) != 0"/>

	</Target>

</Project>